#include <allegro.h>
#include <stdio.h>
#include <stdlib.h>

int main() {
	allegro_init();
	set_color_depth(32);
	set_gfx_mode(GFX_AUTODETECT_WINDOWED, 1000, 600, 0, 0);
	install_keyboard();
	install_mouse();
//	show_mouse(screen);
	
	BITMAP *buffer = create_bitmap(1000,600);
	BITMAP *boneco = load_bitmap("boneco.bmp", NULL);
	BITMAP *terra = load_bitmap("terran_up.bmp", NULL);
	int x,y;
	int a = 20, b = 20;
	int pontosM=0, pontosT=0;
	int vitoriasM=0, vitoriasT=0;
while (!key[KEY_ESC]) {	
		textprintf_ex(screen, font, 345, 10, makecol(250,250,250), -1, "Pressione Enter para iniciar o jogo");
		textprintf_ex(screen, font, 250, 35, makecol(150,10,210), -1, "O objetivo do player do teclado eh escapar e completar 1000 pontos");
		textprintf_ex(screen, font, 250, 47, makecol(150,10,210), -1, "O objetico do player do mouse eh bater no outro e comletar 300 pontos");
		

	while(key[KEY_ENTER]){
		while (!key[KEY_ESC]) {
			textprintf_ex(buffer, font, 0, 565, makecol(250,250,250), -1, "Contagem de VITORIAS");
			textprintf_ex(buffer, font, 0, 580, makecol(250,250,250), -1, "Mouse: %d", vitoriasM);
			textprintf_ex(buffer, font, 0, 590, makecol(250,250,250), -1, "Teclado: %d", vitoriasT);
			
			if (mouse_b & 1){
	 			x = mouse_x;
	 			y = mouse_y;
	 		}
	 				
		 	if(key[KEY_RIGHT])	a+=5;
			if(key[KEY_LEFT])	a-=5;
			if(key[KEY_UP])	b-=5;
			if(key[KEY_DOWN])	b+=5;	
						
			textprintf_ex(buffer, font, 550, 10, makecol(0,10,250), -1, "Mouse: %d", pontosM);
			textprintf_ex(buffer, font, 550, 25, makecol(250,10,0), -1, "Teclado: %d", pontosT);
		
			blit(boneco, buffer, 0,0,mouse_x,mouse_y,50,50);
			blit(terra, buffer, 0,0,a,b,50,50);
			
			if(mouse_x+20 >= a-20 && mouse_x-20 <= a+20 && mouse_y+20 >= b-20 && mouse_y-20 <= b+20) {
				textprintf_ex(buffer, font, 500, 10, makecol(40,40,160), -1, "Bateu");
				pontosM++;		
			}
			
			if(mouse_x+20 < a-20 || mouse_x-20 > a+20 || mouse_y+20 < b-20 || mouse_y-20> b+20) {
				textprintf_ex(buffer, font, 480, 10, makecol(160,40,40), -1, "Escapou");
				pontosT++;		
			}
									
			draw_sprite(screen, buffer, 0,0);
			rest(1);
			clear(buffer);
			
			if(pontosM == 300) {
				vitoriasM++;
				clear(buffer);
				while (!key[KEY_ESC]) {
					textprintf_ex(screen, font, 350, 10, makecol(0,10,250), -1, "Mouse ganhou");
					textprintf_ex(screen, font, 300, 40, makecol(250,250,250), -1, "Pressione Enter para iniciar novamente o jogo");
					if(key[KEY_ENTER]){
						pontosM = 0;
						pontosT = 0;
						break;
					}	
				}
			}
			
			if(pontosT == 1000) {
				vitoriasT++;
				clear(buffer);
					while (!key[KEY_ESC]) {
					textprintf_ex(screen, font, 350, 10, makecol(250,10,0), -1, "Teclado ganhou");
					textprintf_ex(screen, font, 300, 40, makecol(250,250,250), -1, "Pressione Enter para iniciar novamente o jogo");
						if(key[KEY_ENTER]){
							pontosM = 0;
							pontosT = 0;
							break;
					}
				}	
			}
		
		}
	}
	
}
	destroy_bitmap(buffer);
	return 0;
}
END_OF_MAIN()
